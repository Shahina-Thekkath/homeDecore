<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="POS - Bootstrap Admin Template">
    <meta name="keywords"
        content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects">
    <meta name="author" content="Dreamguys - Bootstrap Admin Template">
    <meta name="robots" content="noindex, nofollow">
    <title>Dreams Pos admin template</title>

    <link rel="shortcut icon" type="image/x-icon" href="/admin-assets/img/favicon.jpg">

    <link rel="stylesheet" href="/admin-assets/css/bootstrap.min.css">

    <link rel="stylesheet" href="/admin-assets/css/animate.css">

    <link rel="stylesheet" href="/admin-assets/plugins/select2/css/select2.min.css">

    <link rel="stylesheet" href="/admin-assets/css/dataTables.bootstrap4.min.css">

    <link rel="stylesheet" href="/admin-assets/plugins/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="/admin-assets/plugins/fontawesome/css/all.min.css">

    <link rel="stylesheet" href="/admin-assets/css/style.css">
    <link rel="stylesheet" href="/admin-assets/css/logo.css" />

</head>

<body>
    <div id="global-loader">
        <div class="whirly-loader"> </div>
    </div>

    <div class="main-wrapper">

        <div class="header"> 

            <div class="header-left active">
                <a href="/admin/dashboard" class="logo">
                    <%- include('../../views/partials/icons/icon-logo') %>
                </a>
            </div>

            <a id="mobile_btn" class="mobile_btn" href="#sidebar">
                <span class="bar-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </a>

            <ul class="nav user-menu">

                <li class="nav-item">
                    <div class="top-nav-search">
                      <a href="" class="responsive-search">
                        <i class="fa fa-search"></i>
                      </a>
                      <form class="form-inline" action="/admin/category" method="GET">
                        <input
                          class="form-control mr-sm-2"
                          type="search"
                          name="search"
                          placeholder="Search category..."
                          aria-label="Search"
                        />
                        <button class="btn btn-primary" type="submit">Search</button>
                      </form>
                    </div>
                  </li>


                <li class="nav-item dropdown has-arrow flag-nav">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="javascript:void(0);"
                        role="button">
                        <img src="/admin-assets/img/flags/us1.png" alt="" height="20">
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a href="javascript:void(0);" class="dropdown-item">
                            <img src="/admin-assets/img/flags/us.png" alt="" height="16"> English
                        </a>
                        <a href="javascript:void(0);" class="dropdown-item">
                            <img src="/admin-assets/img/flags/fr.png" alt="" height="16"> French
                        </a>
                        <a href="javascript:void(0);" class="dropdown-item">
                            <img src="/admin-assets/img/flags/es.png" alt="" height="16"> Spanish
                        </a>
                        <a href="javascript:void(0);" class="dropdown-item">
                            <img src="/admin-assets/img/flags/de.png" alt="" height="16"> German
                        </a>
                    </div>
                </li>


                <li class="nav-item dropdown">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
                        <img src="/admin-assets/img/icons/notification-bing.svg" alt="img"> <span
                            class="badge rounded-pill">4</span>
                    </a>
                    <div class="dropdown-menu notifications">
                        <div class="topnav-dropdown-header">
                            <span class="notification-title">Notifications</span>
                            <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
                        </div>
                        <div class="noti-content">
                            <ul class="notification-list">
                                <li class="notification-message">
                                    <a href="activities.html">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="/admin-assets/img/profiles/avatar-02.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">John Doe</span> added
                                                    new task <span class="noti-title">Patient appointment booking</span>
                                                </p>
                                                <p class="noti-time"><span class="notification-time">4 mins ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="notification-message">
                                    <a href="activities.html">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="/admin-assets/img/profiles/avatar-03.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">Tarah Shropshire</span>
                                                    changed the task name <span class="noti-title">Appointment booking
                                                        with payment gateway</span></p>
                                                <p class="noti-time"><span class="notification-time">6 mins ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="notification-message">
                                    <a href="activities.html">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="/admin-assets/img/profiles/avatar-06.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">Misty Tison</span>
                                                    added <span class="noti-title">Domenic Houston</span> and <span
                                                        class="noti-title">Claire Mapes</span> to project <span
                                                        class="noti-title">Doctor available module</span></p>
                                                <p class="noti-time"><span class="notification-time">8 mins ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="notification-message">
                                    <a href="activities.html">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="/admin-assets/img/profiles/avatar-17.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">Rolland Webber</span>
                                                    completed task <span class="noti-title">Patient and Doctor video
                                                        conferencing</span></p>
                                                <p class="noti-time"><span class="notification-time">12 mins ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="notification-message">
                                    <a href="activities.html">
                                        <div class="media d-flex">
                                            <span class="avatar flex-shrink-0">
                                                <img alt="" src="/admin-assets/img/profiles/avatar-13.jpg">
                                            </span>
                                            <div class="media-body flex-grow-1">
                                                <p class="noti-details"><span class="noti-title">Bernardo Galaviz</span>
                                                    added new task <span class="noti-title">Private chat module</span>
                                                </p>
                                                <p class="noti-time"><span class="notification-time">2 days ago</span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="topnav-dropdown-footer">
                            <a href="activities.html">View all Notifications</a>
                        </div>
                    </div>
                </li>

                <li class="nav-item dropdown has-arrow main-drop">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                        <span class="user-img"><img src="/admin-assets/img/profiles/avator1.jpg" alt="">
                            <span class="status online"></span></span>
                    </a>
                    <div class="dropdown-menu menu-drop-user">
                        <div class="profilename">
                            <div class="profileset">
                                <span class="user-img"><img src="/admin-assets/img/profiles/avator1.jpg" alt="">
                                    <span class="status online"></span></span>
                                <div class="profilesets">
                                    <h6>John Doe</h6>
                                    <h5>Admin</h5>
                                </div>
                            </div>
                            <hr class="m-0">
                            <a class="dropdown-item" href="profile.html"> <i class="me-2" data-feather="user"></i> My
                                Profile</a>
                            <a class="dropdown-item" href="generalsettings.html"><i class="me-2"
                                    data-feather="settings"></i>Settings</a>
                            <hr class="m-0">
                            <a class="dropdown-item logout pb-0" href="signin.html"><img
                                    src="/admin-assets/img/icons/log-out.svg" class="me-2" alt="img">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>


            <div class="dropdown mobile-user-menu">
                <a href="javascript:void(0);" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                    aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="profile.html">My Profile</a>
                    <a class="dropdown-item" href="generalsettings.html">Settings</a>
                    <a class="dropdown-item" href="signin.html">Logout</a>
                </div>
            </div>

        </div>


        <div class="sidebar" id="sidebar">
            <div class="sidebar-inner slimscroll">
                <div id="sidebar-menu" class="sidebar-menu">
                    <ul>
                        <li class="">
                            <a href="/admin/dashboard"><span>
                                    Dashboard</span> </a>
                        </li>

                        <li class="">
                            <a href="/admin/users"><span>
                                    Users</span> </a>
                            
                               
                            
                        </li>

                        <li class="">
                            <a href="/admin/productList"><span>
                                    Products</span> </a>
                            
                               
                            
                        </li>                        
                        <li class="active">
                            <a href="/admin/category"><span>
                                    Category</span> </a>
                            
                               
                            
                        </li>                        
                        <li class="">
                            <a href="/admin/orderList"><span>
                                    Orders</span> </a>
                            
                               
                            
                        </li>                        
                        <li class="">
                            <a href="/admin/coupon"><span>
                                    Coupon</span> </a>
                            
                               
                            
                        </li>                        
                        <li class="">
                            <a href="/admin/offer"><span>
                                    Offer</span> </a>
                            
                               
                            
                        </li>  
                        
                        <li class="">
                          <a href="/admin/salesReport"><span> Sales Report</span> </a>
                        </li>
                        <li class="">
                            <a onclick="message(successMessage= 'Logout Successfully')" href="/admin/logout"><span>
                                    Logout</span> </a>
                            
                               
                            
                        </li>                        


                        
                    </ul>
                </div>
            </div>
        </div>

      <div class="page-wrapper">
        <div class="content">
          <div class="page-header">
            <div class="page-title">
              <h4>Category LIST</h4>
              
            </div>
            <div class="page-btn">
              <a href="/admin/addCategory" class="btn btn-added"
                ><img
                  src="/admin-assets/img/icons/plus.svg"
                  class="me-2"
                  alt="img"
                />Add Category</a>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <div class="table-top">
                <div class="search-set">
                  <div class="search-path">
                    <a class="btn btn-filter" id="filter_search">
                      <img src="/admin-assets/img/icons/filter.svg" alt="img" />
                      <span
                        ><img src="/admin-assets/img/icons/closes.svg" alt="img"
                      /></span>
                    </a>
                  </div>
                  <div class="search-input">
                    <a class="btn btn-searchset">
                      <img src="/admin-assets/img/icons/search-white.svg" alt="img" />
                    </a>
                  </div>
                </div>
                <div class="wordset">
                  <ul>
                    <li>
                      <a
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="pdf"
                        ><img src="/admin-assets/img/icons/pdf.svg" alt="img"
                      /></a>
                    </li>
                    <li>
                      <a
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="excel"
                        ><img src="/admin-assets/img/icons/excel.svg" alt="img"
                      /></a>
                    </li>
                    <li>
                      <a
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="print"
                        ><img src="/admin-assets/img/icons/printer.svg" alt="img"
                      /></a>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="card" id="filter_inputs">
                <div class="card-body pb-0">
                <form action="/admin/add-category" method="POST" onsubmit="return handleFormSubmit(event)">
                  <div class="row">
                    <div class="col-lg-2 col-sm-6 col-12">
                      <div class="form-group">
                        <div class="input-groupicon">
                          <input
                            type="text"
                            class="datetimepicker cal-icon"
                            placeholder="Choose Date"
                          />
                          <div class="addonset">
                            <img
                              src="/admin-assets/img/icons/calendars.svg"
                              alt="img"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-2 col-sm-6 col-12">
                      <div class="form-group">
                        <input type="text" placeholder="Enter Reference" />
                      </div>
                    </div>
                    <div class="col-lg-2 col-sm-6 col-12">
                      <div class="form-group">
                        <select class="select">
                          <option>Choose Category</option>
                          <option>Computers</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-lg-2 col-sm-6 col-12">
                      <div class="form-group">
                        <select class="select">
                          <option>Choose Status</option>
                          <option>Complete</option>
                          <option>Inprogress</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-lg-1 col-sm-6 col-12 ms-auto">
                      <div class="form-group">
                        <a class="btn btn-filters ms-auto"
                          ><img
                            src="/admin-assets/img/icons/search-whites.svg"
                            alt="img"
                        /></a>
                      </div>
                    </div>
                  </div>
                </form>
                </div>
              </div>

              <div class="table-responsive">
                <table class="table ">
                  <thead>
                    <tr>
                      
                      <th>Category name</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% cat.forEach((category, index) => { %>
                        <tr>
                          
                          <td><%= category.name %></td>
                          <td>
                            <span class="badges bg-lightgreen">
                              <%= category.isBlocked ? "Blocked" : "Active" %>
                            </span>
                          </td>
                          <td>
                            <% if (category.isBlocked) { %>
                              <button
                                onclick="unblock('<%= category._id %>')"
                                class="btn btn-success btn-sm">
                                <i class="fas fa-unlock"></i> List
                              </button>
                            <% } else { %>
                              <button
                                onclick="block('<%= category._id %>')"
                                class="btn btn-danger btn-sm">
                                <i class="fas fa-ban"></i> UnList
                              </button>
                            <% } %>
                          
                            <a class="me-3" href="/admin/editCategory/<%=category._id%>">
                                <button type="submit" class="btn btn-primary btn-sm" >
                                    Edit
                                  </button>
                            </a>
                            
                          </td>
                        </tr>
                      <% }) %>
                      
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          <li class="page-item <% if (currentPage === 1) { %> disabled <% } %>">
            <a class="page-link" href="<%= baseUrl %>?page=<%= currentPage - 1 %>"
              >Previous</a
            >
          </li>
          <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <% if (i === currentPage) { %> active <% } %>">
            <a class="page-link" href="<%= baseUrl %>?page=<%= i %>"><%= i %></a>
          </li>
          <% } %>
          <li
            class="page-item <% if (currentPage === totalPages) { %> disabled <% } %>"
          >
            <a class="page-link" href="<%= baseUrl %>?page=<%= currentPage + 1 %>"
              >Next</a
            >
          </li>
        </ul>
      </nav>
  
     
      <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script src="/admin-assets/js/jquery-3.6.0.min.js"></script>

    <script src="/admin-assets/js/feather.min.js"></script>

    <script src="/admin-assets/js/jquery.slimscroll.min.js"></script>

    <script src="/admin-assets/js/jquery.dataTables.min.js"></script>
    <script src="/admin-assets/js/dataTables.bootstrap4.min.js"></script>

    <script src="/admin-assets/js/bootstrap.bundle.min.js"></script>

    <script src="/admin-assets/js/moment.min.js"></script>
    <script src="/admin-assets/js/bootstrap-datetimepicker.min.js"></script>

    <script src="/admin-assets/plugins/select2/js/select2.min.js"></script>

    <script src="/admin-assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
    <script src="/admin-assets/plugins/sweetalert/sweetalerts.min.js"></script>

    <script src="/admin-assets/js/script.js"></script>

   <script>
     
     function handleFormSubmit(event){
        event.preventDefault();
        if(!validateFrom()){
            return
        }
        const name = document.getElementsByName("name")[0].value;
        
        fetch('/admin/addCategory',{
            method: 'POST',
            headers: {
                'content-type': 'application/json'
            },
            body: JSON.stringify({name, description})
        })
        .then(response =>{
            if(!response.ok){
                return response.json().then(err =>{
                    throw new Error(err.error); 
                })
            }
            return response.json();
        })
        .then(data =>{
            location.reload();
        })
        .catch(error =>{
            if(error.message === "Category already exists"){
                Swal.fire({
                    icon:'error',
                    title: "oops",
                    text: "Category already exists"
                })
            }else{
                Swal.fire({
                    icon: "error",
                    title: "oops",
                    text: "An error occured while adding the category",

                })
                
            }
        })
     }


     function validateForm(){
        clearErrorMessages();
        const name = document.getElementByName("name")[0].value.trim();
        isValid = true;



        if(name === ""){
            displayErrorMessage("name-error","please enter a name");
            isValid = false;
        }else if(!/^[a-zA-Z\s]+$/.test(name)){
            displayErrorMessage("name-error", "Category name should contain only alphabetic characters");
            isValid = false;

        }
        if(description === ""){
            displayErrorMessage("description-error", "Please enter a description");
            isValid = false
        }
        return isValid;
     }


     function displayErrorMessage(elementId,message){
        var errorElement = document.getElementById(elementId);
        errorElement.innerText = message;
        errorElement.style.display = "block";
     }
     
     function clearErrorMessages(){
        const errorElements = document.getElementsByClassName("error-message");
        Array.from(errorElements).forEach((element) =>{
             element.innerText = "";
             element.style.display = 'none';
        })
     }

   </script>

<script>
    function block(id) {
      console.log("block");
      Swal.fire({
        title: "Are you sure?",
        text: "you won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes, block it!",
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            type: "DELETE",
            url: `/admin/categoryBlock/${id}`,
            success: function (response) {
              if (response.success) {
                Swal.fire({
                  icon: "success",
                  title: "Blocked!",
                  text: "Category has been blocked.",
                  showConfirmButton: false,
                  timer: 1500,
                }).then(() => location.reload(true)); //load the hard copy ignoring the cahex data
              } else {
                Swal.fire({
                  icon: "error",
                  title: "Error",
                  text: response.message,
                });
              }
            },
            error: function () {
              Swal.fire({
                icon: "error",
                title: "Error",
                text: "An error occurred while blocking the Category",
              });
            },
          });
        }
      });
    }

    function unblock(id) {
      console.log("unblock");
      Swal.fire({
        title: "Are you sure?",
        text: "You won't be able to revert this!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        confirmButtonText: "yes, unblock it!",
      }).then((result) => {
        if (result.isConfirmed) {
          $.ajax({
            type: "PUT",
            url: `/admin/categoryUnblock/${id}`,
            success: function (response) {
              if (response.success) {
                Swal.fire({
                  icon: "success",
                  title: "Unblocked!",
                  text: "Category has been unblocked",
                  showConfirmButton: false,
                  timer: 1500,
                }).then(() => location.reload(true));
              } else {
                Swal.fire({
                  icon: "error",
                  title: "Error",
                  text: response.message,
                });
              }
            },
            error: function () {
              Swal.fire({
                icon: "error",
                title: "Error",
                text: "An error occured while unblocking the category",
              });
            },
          });
        }
      });
    }

    function message(msg){
            if(msg){
                  Swal.fire({
                    positition: "center",
                    icon: "success",
                    title: msg,
                    showConfirmButton: false,
                    timer: 3000
                  }).then(() =>{
                    window.location.href = "/admin";
                  })
            }
          }
  </script>


  </body>
</html>
