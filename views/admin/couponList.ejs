<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <meta name="description" content="POS - Bootstrap Admin Template" />
    <meta
      name="keywords"
      content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects"
    />
    <meta name="author" content="Dreamguys - Bootstrap Admin Template" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Dreams Pos admin template</title>

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/admin-assets/img/favicon.jpg"
    />

    <link rel="stylesheet" href="/admin-assets/css/bootstrap.min.css" />

    <link rel="stylesheet" href="/admin-assets/css/animate.css" />

    <link
      rel="stylesheet"
      href="/admin-assets/plugins/select2/css/select2.min.css"
    />

    <link
      rel="stylesheet"
      href="/admin-assets/css/dataTables.bootstrap4.min.css"
    />

    <link
      rel="stylesheet"
      href="/admin-assets/plugins/fontawesome/css/fontawesome.min.css"
    />
    <link
      rel="stylesheet"
      href="/admin-assets/plugins/fontawesome/css/all.min.css"
    />

    <link rel="stylesheet" href="/admin-assets/css/style.css" />
    <link rel="stylesheet" href="/admin-assets/css/logo.css" />

  </head>

  <body>
    <div id="global-loader">
      <div class="whirly-loader"></div>
    </div>

    <div class="main-wrapper">
      <div class="header">
        <div class="header-left active">
          <a href="/admin/dashboard" class="logo">
                    <%- include('../../views/partials/icons/icon-logo') %>
           </a>
        </div>

        <a id="mobile_btn" class="mobile_btn" href="#sidebar">
          <span class="bar-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </a>

        <div class="dropdown mobile-user-menu">
          <a
            href="javascript:void(0);"
            class="nav-link dropdown-toggle"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            ><i class="fa fa-ellipsis-v"></i
          ></a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="profile.html">My Profile</a>
            <a class="dropdown-item" href="generalsettings.html">Settings</a>
            <a class="dropdown-item" href="signin.html">Logout</a>
          </div>
        </div>
      </div>

      <div class="sidebar" id="sidebar">
        <div class="sidebar-inner slimscroll">
          <div id="sidebar-menu" class="sidebar-menu">
            <ul>
              <li class="">
                <a href="/admin/dashboard"><span> Dashboard</span> </a>
              </li>

              <li class="">
                <a href="/admin/users"><span> Users</span> </a>
              </li>

              <li class="">
                <a href="/admin/productList"><span> Products</span> </a>
              </li>
              <li class="">
                <a href="/admin/category"><span> Category</span> </a>
              </li>
              <li >
                <a href="/admin/orderList"><span> Orders</span> </a>
              </li>
              <li class="active">
                <a href="/admin/coupon"><span> Coupon</span> </a>
              </li>
              <li class="">
                <a href="/admin/offer"><span> Offer</span> </a>
              </li>
              <li class="">
                <a href="/admin/salesReport"><span> Sales Report</span> </a>
              </li>
              <li class="">
                <a
                  onclick="message(successMessage= 'Logout Successfully')"
                  href="/admin/logout"
                  ><span> Logout</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="page-wrapper">
        <div class="content">
          <div class="page-header">
            <div class="page-title">
              <h4>Coupon List</h4>
              <h6>Manage your coupons</h6>
            </div>
            <div class="page-btn">
                        <a href="/admin/coupon/add-coupon" class="btn btn-added"><img src="/admin-assets/img/icons/plus.svg" alt="img"
                                class="me-1">Add New Coupon</a>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <div class="table-top">
                <div class="search-set">
                  
                  <div class="search-input">
                    <a class="btn btn-searchset"
                      ><img
                        src="/admin-assets/img/icons/search-white.svg"
                        alt="img"
                    /></a>
                  </div>
                </div>
              </div>

              <div class="table-responsive">
                <table class="table datanew">
                  <thead>
                    <tr>
                      <th>Coupon Name</th>
                      <th>Coupon Code</th>

                      <th>Expiry Date</th>

                      <th>Discount Type</th>
                      <th>Discount Amount</th>
                      <th>Min. Purchase Amount</th>
                      <th>Status</th>

                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% coupons.forEach((coupon) =>{%>
                    <tr>
                      <td><%= coupon.name %></td>
                      <td>
                        <%= coupon.code %> <br />
                        
                      </td>
                      <td>
                        <%= new Date(coupon.expiresOn).toLocaleDateString() %>
                      </td>
                      <td><%= coupon.discountType%></td>
                      <td><%= coupon.discountAmount %></td>
                      <td><%= coupon.minPurchaseAmount %></td>
                      <td><%= coupon.isActive? 'Active' : 'Inactive' %></td>

                      <td>
                        <a
                          class="me-3"
                          href="/admin/coupon/edit-coupon/<%= coupon._id %>"
                        >
                          <img
                            src="/admin-assets/img/icons/edit.svg"
                            alt="img"
                          />
                        </a>
                        <button class="btn btn-sm <%= coupon.isActive ? 'btn-danger' : 'btn-success' %> toggle-status"
                            data-id="<%= coupon._id %>">
                            <%= coupon.isActive ? 'Deactivate' : 'Activate' %>
                        </button>
                      </td>
                    </tr>
                    <%})%>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/admin-assets/js/jquery-3.6.0.min.js"></script>

    <script src="/admin-assets/js/feather.min.js"></script>

    <script src="/admin-assets/js/jquery.slimscroll.min.js"></script>

    <script src="/admin-assets/js/jquery.dataTables.min.js"></script>
    <script src="/admin-assets/js/dataTables.bootstrap4.min.js"></script>

    <script src="/admin-assets/js/bootstrap.bundle.min.js"></script>

    <script src="/admin-assets/plugins/select2/js/select2.min.js"></script>

    <script src="/admin-assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
    <script src="/admin-assets/plugins/sweetalert/sweetalerts.min.js"></script>

    <script src="/admin-assets/js/script.js"></script>
    
    <script>
          function message(msg){
            if(msg){
                  Swal.fire({
                    positition: "center",
                    icon: "success",
                    title: msg,
                    showConfirmButton: false,
                    timer: 3000
                  }).then(() =>{
                    window.location.href = "/admin";
                  })
            }
          }

    </script>

    <script>
        $(document).ready(function () {
           $(document).on('click', '.toggle-status', function () {
                const button = $(this);
                const couponId = button.data('id');

                Swal.fire({
                    title: 'Are you Sure?',
                    text: 'Do you want to change the coupon status?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, change it!'
                }).then((result) => {
                    if(result.isConfirmed) {
                       $.ajax({
                        url: `/admin/coupons/toggle/${couponId}`,
                        method: 'PATCH',
                        success: function (response) {
                            Swal.fire('Success', response.message, 'success').then(() => {
                                location.reload();
                            });
                        },
                        error: function () {
                            Swal.fire('Error', 'Something went wrong', 'error');
                        }
                       });
                    }
                });
            });
        });
    </script>

  </body>
</html>
