<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="UTF-8">
    <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="images/favicon.png" rel="shortcut icon">
    <title>Ludus - Electronics, Apparel, Computers, Books, DVDs & more</title>

    <!--====== Google Font ======-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet">

    <!--====== Vendor Css ======-->
    <link rel="stylesheet" href="css/vendor.css">

    <!--====== Utility-Spacing ======-->
    <link rel="stylesheet" href="css/utility.css">

    <!--====== App ======-->
    <link rel="stylesheet" href="css/app.css">

    <!--====== coupon modal style ======-->
    <link rel="stylesheet" href="css/couponModal.css">

    <link rel="stylesheet" href="/css/productDetailsLogo.css">

    <link rel="stylesheet" href="/css/profileName.css">

    <link rel="stylesheet" href="/css/checkout.css">
   
    <!--====== find coupon css ======-->
    <style>
        .u-s-p-b-60 { padding-bottom: 60px; }
        .u-s-m-b-16 { margin-bottom: 16px; }
        .u-s-m-b-15 { margin-bottom: 15px; }
        .msg { 
            background: #fff8e1; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 15px;
            border-left: 4px solid #ff6b35;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.1);
        }
        .msg__text { 
            font-size: 16px; 
            color: #333;
            display: block;
            margin-bottom: 10px;
        }
        .gl-link { 
            color: #ff6b35; 
            text-decoration: none;
            font-weight: 500;
        }
        .gl-link:hover { 
            color: #e55a2b; 
            text-decoration: underline;
        }
        .gl-text { 
            color: #666; 
            font-size: 14px;
            display: block;
        }
        .input-text {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        .input-text--primary-style:focus {
            border-color: #ff6b35;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn--e-transparent-brand-b-2 {
            background-color: #ff6b35;
            color: white;
            border: 2px solid #ff6b35;
        }
        .btn--e-transparent-brand-b-2:hover {
            background-color: #e55a2b;
            border-color: #e55a2b;
        }
        .coupon-finder {
            background: linear-gradient(135deg, #ff6b35 0%, #ffa500 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        .coupon-finder__text {
            font-size: 16px;
            margin-bottom: 12px;
            display: block;
            font-weight: 500;
        }
        .coupon-finder__link {
            color: #ff6b35;
            background: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
            transition: all 0.3s ease;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .coupon-finder__link:hover {
            background: #fff3e0;
            color: #e55a2b;
            text-decoration: none;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .c-f {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .discount-amount {
            padding-right: 12px; /* Moves text away from right edge */
        }
    </style>

</head>
<body class="config">
    <div class="preloader is-active">
        <div class="preloader__wrap">

            <img class="preloader__img" src="images/preloader.png" alt=""></div>
    </div>

    <!--====== Main App ======-->
    <div id="app">

        <!--====== Main Header ======-->
        <header class="header--style-1 header--box-shadow">

            <!--====== Nav 1 ======-->
            <nav class="primary-nav primary-nav-wrapper--border">
                <div class="container">

                    <!--====== Primary Nav ======-->
                    <div class="primary-nav">

                        <!--====== Main Logo ======-->

                        <a
                                class="main-logo"
                                href="/"
                                style="display: inline-block; margin-left: -15px"
                            >
                                <%- include('../../views/partials/icons/icon-logo') %>
                            </a>
                        <!--====== End - Main Logo ======-->


                        <!--====== Dropdown Main plugin ======-->
                        <div class="menu-init" id="navigation">

                            <button class="btn btn--icon toggle-button fas fa-cogs" type="button"></button>

                            <!--====== Menu ======-->
                            <div class="ah-lg-mode">

                                <span class="ah-close">✕ Close</span>

                                <!--====== List ======-->
                               <ul class="ah-list ah-list--design1 ah-list--link-color-secondary">
                                    <li class="has-dropdown" data-tooltip="tooltip" data-placement="left" title="Account">

                                        <%if(locals.user){%>
                                                <a href="/profile"><i ><%=locals.user.name%></i></a>

                                            <%}else{%>

                                                <a><i class="far fa-user-circle"></i></a>

                                                <%}%>

                                        <!--====== Dropdown ======-->

                                        <span class="js-menu-toggle"></span>
                                        <ul style="width:120px">

                                           
                                           
                                                    <%if(locals.user){%>
                                                        <li>
                                                           <a href="/profile" title="<%=locals.user.name%>"><i><%=locals.user.name%></i>

                                                            </a>
                                                        </li> 
                                                           
                                                   
                                                       
                                                        <li>

                                                            <a href="/logout"><i class="fas fa-lock-open u-s-m-r-6"></i>
        
                                                                <span>Logout</span></a>
                                                        </li>
                                                    <%}else{%>
                                                        <li>

                                                            <a href="/signup"><i class="fas fa-user-plus u-s-m-r-6"></i>
        
                                                                <span>Signup</span></a>
                                                        </li>
                                                        <li>

                                                            <a href="/login"><i class="fas fa-lock u-s-m-r-6"></i>
        
                                                            <span>Login</span></a>
                                                        </li>
                                                    <%}%>
                                        </ul>
                                        <!--====== End - Dropdown ======-->
                                    </li>
                                    
                                </ul>
                                <!--====== End - List ======-->
                            </div>
                            <!--====== End - Menu ======-->
                        </div>
                        <!--====== End - Dropdown Main plugin ======-->
                    </div>
                    <!--====== End - Primary Nav ======-->
                </div>
            </nav>
            <!--====== End - Nav 1 ======-->


            <!--====== Nav 2 ======-->
            <nav class="secondary-nav-wrapper">
                <div class="container">

                    <!--====== Secondary Nav ======-->
                    <div class="secondary-nav">

                        <!--====== Dropdown Main plugin ======-->
                        <div class="menu-init" id="navigation1"></div>
                        <!--====== End - Dropdown Main plugin ======-->


                        <!--====== Dropdown Main plugin ======-->
                        <div class="menu-init" id="navigation2"> </div>
                        <!--====== End - Dropdown Main plugin ======-->


                        <!--====== Dropdown Main plugin ======-->
                        <div class="menu-init" id="navigation3">

                            <button class="btn btn--icon toggle-button fas fa-shopping-bag toggle-button-shop" type="button"></button>

                            <!--====== Menu ======-->
                            <div class="ah-lg-mode">

                                <span class="ah-close">✕ Close</span>

                                <!--====== List ======-->
                                <ul class="ah-list ah-list--design1 ah-list--link-color-secondary">
                                    <li>

                                        <a href="/"><i class="fas fa-home"></i></a></li>
                                    <li>

                                        <a href="/wishlist"><i class="far fa-heart"></i></a></li>
                                    <li class="has-dropdown">

                                        <a class="mini-cart-shop-link" href="/cart"><i class="fas fa-shopping-bag"></i></a>

                                        <!--====== Dropdown ======-->

                                        <span class="js-menu-toggle"></span>
                                        
                                        <!--====== End - Dropdown ======-->
                                    </li>
                                </ul>
                                <!--====== End - List ======-->
                            </div>
                            <!--====== End - Menu ======-->
                        </div>
                        <!--====== End - Dropdown Main plugin ======-->
                    </div>
                    <!--====== End - Secondary Nav ======-->
                </div>
            </nav>
            <!--====== End - Nav 2 ======-->
        </header>
        <!--====== End - Main Header ======-->


        <!--====== App Content ======-->
        <div class="app-content">

            <!--====== Section 1 ======-->
            <div class="u-s-p-y-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="breadcrumb">
                            <div class="breadcrumb__wrap">
                                <ul class="breadcrumb__list">
                                    <li class="has-separator">

                                        <a href="/">Home</a></li>
                                    <li class="is-marked">

                                        <a href="/checkout">Checkout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--====== End - Section 1 ======-->


            <!--====== Section 2 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div id="checkout-msg-group">
                                    <!-- Find Coupons Section -->
                                    <div class="coupon-finder">
                                        <span class="coupon-finder__text">Looking for savings? Don't miss out on our latest deals!</span>
                                        <a class="coupon-finder__link" href="#" data-toggle="modal" data-target="#couponModal" >
                                            Browse Available Coupons & Offers
                                        </a>
                                    </div>
                                    
                                    <div class="msg">

                                        <span class="msg__text">Have a coupon?

                                            <a class="gl-link" href="#have-coupon" data-toggle="collapse">Click Here to enter your code</a></span>
                                        <div class="collapse" id="have-coupon" data-parent="#checkout-msg-group">
                                            <div class="c-f u-s-m-b-16">

                                                <span class="gl-text u-s-m-b-16">Enter your coupon code if you have one.</span>
                                                <form class="c-f__form">
                                                    <div class="u-s-m-b-16">
                                                        <div class="u-s-m-b-15">

                                                            <label for="coupon"></label>

                                                            <input class="input-text input-text--primary-style" type="text" id="coupon" placeholder="Coupon Code"></div>
                                                        <div class="u-s-m-b-15">

                                                            <button class="btn btn--e-transparent-brand-b-2" type="submit">APPLY</button></div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 2 ======-->

            <!--====== Section 3 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="checkout-f">
                            <div class="row">
                                <div class="col-lg-6">
                                    
                                    <div class="o-summary__section u-s-m-b-30">
                                        <div class="o-summary__box">
                                            <h1 class="checkout-f__h1">SHIPPING & BILLING</h1>
                                            <div class="ship-b">

                                                <span class="ship-b__text">Ship to:</span>
                                                    <div class="ship-b__box u-s-m-b-10" id="ship-to-address">
                                                        <% if (selectedAddress) { %>
                                                            <p class="ship-b__p">
                                                                <%= selectedAddress.name %>, <%= selectedAddress.address %>,
                                                                <%= selectedAddress.locality %>,<%= selectedAddress.city %>, <%= selectedAddress.state %>,
                                                                <%= selectedAddress.country %>, <%= selectedAddress.pincode %>
                                                            </p>
                                                        <% } else { %>
                                                            <p class="ship-b__p text-danger">No address selected or available.</p>
                                                        <% } %>

                                                        
                                                        <% if (selectedAddress) { %>
                                                            <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal"
                                                                data-modal-id="#edit-ship-address"
                                                                href="/editAddress/<%= selectedAddress._id %>?from=checkout">Edit</a>
                                                        <% } %>
                                                            

                                                    </div>

                                                <div class="ship-b__box">

                                                    <a href="/addAddress?from=checkout">
                                                        <button class="btn btn--e-brand-b-2 custom-button" type="button">
                                                          ADD NEW ADDRESS
                                                        </button>
                                                      </a>

                                                    <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Change</a></div>
                                            </div>
                                        </div>
                                    </div>



                                    <div class="o-summary__section u-s-m-b-30">
                                        <div class="o-summary__box">
                                            <h1 class="checkout-f__h1">PAYMENT INFORMATION</h1>
                                            <form class="checkout-f__payment" id="orderForm" action="/order-save" method="POST">


                                                <input type="hidden" name="grandTotal" value="<%= grandTotal %>">
                                                <input type="hidden" name="discountAmount" value="<%= discountAmount || 0 %>">
                                                <% cartItems.forEach((item, index) =>{%>
                                                    <input type="hidden" name="cartItems[<%= index %>][id]" value="<%= item.productId._id %>">

                                                   <input type="hidden" name="cartItems[<%= index %>][name]" value="<%= item.productId.name %>">
                                                   <input type="hidden" name="cartItems[<%= index %>][price]" value="<%= item.price %>">
                                                   <input type="hidden" name="cartItems[<%= index %>][discountedPrice]" value="<%= item.discountedPrice %>">
                                                   <input type="hidden" name="cartItems[<%= index %>][quantity]" value="<%= item.quantity %>">
                                                   <input type="hidden" name="cartItems[<%= index %>][subtotal]" value="<%= item.subtotal %>">
                
                
                                                <% }) %>

                                                <% if(selectedAddress){ %>
                                                <input type="hidden" name="shippingAddress[name]" value="<%= selectedAddress.name %>">
                                                <input type="hidden" name="shippingAddress[address]" value="<%= selectedAddress.address %>">
                                                <input type="hidden" name="shippingAddress[locality]" value="<%= selectedAddress.locality %>">
                                                <input type="hidden" name="shippingAddress[state]" value="<%= selectedAddress.state %>">
                                                <input type="hidden" name="shippingAddress[country]" value="<%= selectedAddress.country %>">
                                                <input type="hidden" name="shippingAddress[pincode]" value="<%= selectedAddress.pincode %>">
                                                <% } %>
                                                

                

                                                <div class="u-s-m-b-10">

                                                    <!--====== Radio Box ======-->
                                                    <div class="radio-box">

                                                        <input id='cod' type="radio" id="cash-on-delivery" name="payment" value="Cash on Delivery" required>
                                                        <div class="radio-box__state radio-box__state--primary">

                                                            <label class="radio-box__label" for="cash-on-delivery">Cash on Delivery</label></div>
                                                    </div>
                                                    <!--====== End - Radio Box ======-->

                                                    <span class="gl-text u-s-m-t-6">Pay Upon Cash on delivery. (This service is only available for some countries)</span>
                                                </div>
                                                <div class="u-s-m-b-10">

                                                    <!--====== Radio Box ======-->
                                                    <div class="radio-box">

                                                        <input type="radio" id="wallet-payment" name="payment" value="wallet" required>
                                                        <div class="radio-box__state radio-box__state--primary">

                                                            <label class="radio-box__label" for="wallet-payment">Wallet Payment
                                                                <span class="wallet-balance-inline" id="wallet-balance" data-balance="<%= walletBalance || 0 %>">
                                                                    (Balance: ₹<%= (walletBalance || 0).toFixed(2) %>)
                                                                </span>
                                                            </label></div>
                                                    </div>
                                                    <!--====== End - Radio Box ======-->

                                                    <span class="gl-text u-s-m-t-6">Pay instantly using your wallet balance. Your order will be processed immediately.</span>
                                                </div>
                                                
                                                <div class="u-s-m-b-10">

                                                    <!--====== Radio Box ======-->
                                                    <div class="radio-box disabled">

                                                        <input type="radio" id="pay-with-card" name="payment" value="Credit/Debit Card" required>
                                                        <div class="radio-box__state radio-box__state--primary">

                                                            <label class="radio-box__label" for="pay-with-card">Pay With Credit / Debit Card</label></div>
                                                    </div>
                                                    <!--====== End - Radio Box ======-->

                                                    <span class="gl-text u-s-m-t-6">International Credit Cards must be eligible for use within the United States.</span>
                                                </div>
                                                <div class="u-s-m-b-10">

                                                    <!--====== Radio Box ======-->
                                                    <div class="radio-box">

                                                        <input type="radio" id="razorpay" name="payment" value="Razorpay" required>
                                                        <div class="radio-box__state radio-box__state--primary">

                                                            <label class="radio-box__label" for="razorpay">Razorpay</label></div>
                                                    </div>
                                                    <!--====== End - Radio Box ======-->

                                                    <span class="gl-text u-s-m-t-6">When you click "Place Order" below we'll take you to Razorpay's site to set up your billing information.</span>
                                                </div>
                                                
                                                <div>

                                                 <button class="btn btn--e-brand-b-2" id="placeOrderBtn" type="submit" >PLACE ORDER</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>



                                </div>
                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">ORDER SUMMARY</h1>

                                    <!--====== Order Summary ======-->
                                    <div class="o-summary">
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__item-wrap gl-scroll">

                                                <%cartItems.forEach((item) =>{%> 
                                                <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">
                                                            <% let img = item.productId.image[0] %>   
                                                            <img class="u-img-fluid" src="<%= img.url %>" alt=""></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">

                                                                <a href="product-detail.html"><%=item.productId.name%></a></span>

                                                            <span class="o-card__quantity">Quantity x <%=item.quantity%></span>

                                                            <span class="o-card__price">₹<%=item.discountedPrice.toFixed(2)%></span></div>
                                                    </div>
                                                    <button 
                                                            class="o-card__del" 
                                                            onclick="deleteItem('<%=item._id%>')" 
                                                            title="Delete Item" 
                                                            style="background: none; border: none; padding: 0;"
                                                            >
                                                            <i class="far fa-trash-alt"></i>
                                                            </button>
                                                </div>
                                                <%})%>
                                                
                                               


                                            </div>
                                        </div>
                                       
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <table class="o-summary__table">
                                                    <tbody>
                                                        <tr>
                                                            <td>SUBTOTAL</td>
                                                            <td>₹<%= grandTotal.toFixed(2) %></td>
                                                        </tr>
                                                        <tr>
                                                            <td>SHIPPING</td>
                                                            <td id="shippingCharge">₹0.00</td>
                                                        </tr>
                                                        <tr>
                                                            <td>GRAND TOTAL</td>
                                                            <td id="grand-total">₹<%= grandTotal.toFixed(2) %></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        
                                    </div>
                                    <!--====== End - Order Summary ======-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 3 ======-->
        </div>
        <!--====== End - App Content ======-->


        <!--====== Main Footer ======-->
        <footer>
            <div class="outer-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-4 col-md-6">
                            <div class="outer-footer__content u-s-m-b-40">

                                <span class="outer-footer__content-title">Contact Us</span>
                                <div class="outer-footer__text-wrap"><i class="fas fa-home"></i>

                                    <span>4247 Ashford Drive Virginia VA-20006 USA</span></div>
                                <div class="outer-footer__text-wrap"><i class="fas fa-phone-volume"></i>

                                    <span>(+0) 900 901 904</span></div>
                                <div class="outer-footer__text-wrap"><i class="far fa-envelope"></i>

                                    <span>contact@domain.com</span></div>
                                <div class="outer-footer__social">
                                    <ul>
                                        <li>

                                            <a class="s-fb--color-hover" href="#"><i class="fab fa-facebook-f"></i></a></li>
                                        <li>

                                            <a class="s-tw--color-hover" href="#"><i class="fab fa-twitter"></i></a></li>
                                        <li>

                                            <a class="s-youtube--color-hover" href="#"><i class="fab fa-youtube"></i></a></li>
                                        <li>

                                            <a class="s-insta--color-hover" href="#"><i class="fab fa-instagram"></i></a></li>
                                        <li>

                                            <a class="s-gplus--color-hover" href="#"><i class="fab fa-google-plus-g"></i></a></li>
                                    </ul>
                                </div>
                            </div> 
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="outer-footer__content u-s-m-b-40">

                                        <span class="outer-footer__content-title">Information</span>
                                        <div class="outer-footer__list-wrap">
                                            <ul>
                                                <li>

                                                    <a href="cart.html">Cart</a></li>
                                                <li>

                                                    <a href="dashboard.html">Account</a></li>
                                                <li>

                                                    <a href="shop-side-version-2.html">Manufacturer</a></li>
                                                <li>

                                                    <a href="dash-payment-option.html">Finance</a></li>
                                                <li>

                                                    <a href="shop-side-version-2.html">Shop</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="outer-footer__content u-s-m-b-40">
                                        <div class="outer-footer__list-wrap">

                                            <span class="outer-footer__content-title">Our Company</span>
                                            <ul>
                                                <li>

                                                    <a href="about.html">About us</a></li>
                                                <li>

                                                    <a href="contact.html">Contact Us</a></li>
                                                <li>

                                                    <a href="index.html">Sitemap</a></li>
                                                <li>

                                                    <a href="dash-my-order.html">Delivery</a></li>
                                                <li>

                                                    <a href="shop-side-version-2.html">Store</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="outer-footer__content">

                                <span class="outer-footer__content-title">Join our Newsletter</span>
                                <form class="newsletter">
                                    <div class="u-s-m-b-15">
                                        <div class="radio-box newsletter__radio">

                                            <input type="radio" id="male" name="gender">
                                            <div class="radio-box__state radio-box__state--primary">

                                                <label class="radio-box__label" for="male">Male</label></div>
                                        </div>
                                        <div class="radio-box newsletter__radio">

                                            <input type="radio" id="female" name="gender">
                                            <div class="radio-box__state radio-box__state--primary">

                                                <label class="radio-box__label" for="female">Female</label></div>
                                        </div>
                                    </div>
                                    <div class="newsletter__group">

                                        <label for="newsletter"></label>

                                        <input class="input-text input-text--only-white" type="text" id="newsletter" placeholder="Enter your Email">

                                        <button class="btn btn--e-brand newsletter__btn" type="submit">SUBSCRIBE</button></div>

                                    <span class="newsletter__text">Subscribe to the mailing list to receive updates on promotions, new arrivals, discount and coupons.</span>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="lower-footer">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="lower-footer__content">
                                <div class="lower-footer__copyright">

                                    <span>Copyright © 2018</span>

                                    <a href="index.html">Reshop</a>

                                    <span>All Right Reserved</span></div>
                                <div class="lower-footer__payment">
                                    <ul>
                                        <li><i class="fab fa-cc-stripe"></i></li>
                                        <li><i class="fab fa-cc-paypal"></i></li>
                                        <li><i class="fab fa-cc-mastercard"></i></li>
                                        <li><i class="fab fa-cc-visa"></i></li>
                                        <li><i class="fab fa-cc-discover"></i></li>
                                        <li><i class="fab fa-cc-amex"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <!--====== Modal Section ======-->


        <!--====== Shipping Address Add Modal ======-->
        <div class="modal fade" id="edit-ship-address">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="checkout-modal2">
                            <div class="u-s-m-b-30">
                                <div class="dash-l-r">
                                    <h1 class="gl-modal-h1">Shipping Address</h1>
                                    <!-- <div class="dash__link dash__link--brand">

                                        <a data-modal="modal" data-modal-id="#add-ship-address" data-dismiss="modal">Add new Address</a></div>
                                </div> -->
                            </div>
                            <form class="checkout-modal2__form">
                                <div class="dash__table-2-wrap u-s-m-b-30 gl-scroll">
                                    <table class="dash__table-2">
                                        <thead>
                                            <tr>
                                                <th>Action</th>
                                                
                                                <th>Address</th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% addresses.forEach((address, index) => { %>
                                            <tr>
                                                <td>
                                                    <!--====== Radio Box ======-->
                                                    <div class="radio-box">
                                                        <input 
                                                            type="radio" 
                                                            class="address-radio" 
                                                            name="selectedAddress" 
                                                            id="address<%= index %>" 
                                                            value="<%= address._id %>" 
                                                            data-address="<%= JSON.stringify(address) %>"
                                                            <% if ((selectedAddress && address._id.toString() === selectedAddress._id.toString()) || (!selectedAddress && index === 0)) { %> checked <% } %>


                                                        >
                                                        <div class="radio-box__state radio-box__state--primary">
                                                            <label class="radio-box__label" for="address<%= index %>"></label>
                                                        </div>
                                                    </div>
                                                    <!--====== End - Radio Box ======-->
                                                </td>
                                                <td><%= address.name %></td>
                                                <td><%= address.address %></td>
                                            </tr>
                                            <% }) %>
                                        </tbody>
                                        
                                    </table>
                                </div>
                                <div class="gl-modal-btn-group">

                                    <button class="btn btn--e-brand-b-2" type="submit">SAVE</button>

                                    <button class="btn btn--e-grey-b-2" type="button" data-dismiss="modal">CANCEL</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Shipping Address Add Modal ======-->


        <!--====== Shipping Address Add Modal ======-->
        <div class="modal fade" id="add-ship-address">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="checkout-modal1">
                            <form class="checkout-modal1__form">
                                <div class="u-s-m-b-30">
                                    <h1 class="gl-modal-h1">Add new Shipping Address</h1>
                                </div>

                                
                                <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-fname">FIRST NAME *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-fname" placeholder="First Name"></div>
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-lname">LAST NAME *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-lname" placeholder="Last Name"></div>
                                </div>
                                <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-phone">PHONE *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-phone"></div>
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-street">STREET ADDRESS *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-street" placeholder="House Name and Street"></div>
                                </div>
                                <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <!--====== Select Box ======-->

                                        <label class="gl-label" for="address-country">COUNTRY *</label><select class="select-box select-box--primary-style" id="address-country">
                                            <option selected value="">Choose Country</option>
                                            <option value="uae">United Arab Emirate (UAE)</option>
                                            <option value="uk">United Kingdom (UK)</option>
                                            <option value="us">United States (US)</option>
                                        </select>
                                        <!--====== End - Select Box ======-->
                                    </div>
                                    <div class="u-s-m-b-30">

                                        <!--====== Select Box ======-->

                                        <label class="gl-label" for="address-state">STATE/PROVINCE *</label><select class="select-box select-box--primary-style" id="address-state">
                                            <option selected value="">Choose State/Province</option>
                                            <option value="al">Alabama</option>
                                            <option value="al">Alaska</option>
                                            <option value="ny">New York</option>
                                        </select>
                                        <!--====== End - Select Box ======-->
                                    </div>
                                </div>
                                <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-city">TOWN/CITY *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-city"></div>
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-street">ZIP/POSTAL CODE *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-postal" placeholder="Zip/Postal Code"></div>
                                </div>
                                <div class="gl-modal-btn-group">

                                    <button class="btn btn--e-brand-b-2" type="submit">SAVE</button>

                                    <button class="btn btn--e-grey-b-2" type="button" data-dismiss="modal">CANCEL</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Shipping Address Add Modal ======-->
        <!--====== End - Modal Section ======-->
    </div>
    <!--====== End - Main App ======-->

    <div class="modal fade coupon-modal" id="couponModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-tags mr-2"></i>
                    Available Coupons & Offers
                </h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            
       
            
            <!-- Modal Body -->
            <div class="modal-body">
              
                <% if(coupons && coupons.length > 0) { %>

                   <% percentageCoupons.forEach(coupon => { %>

                   <div class="coupon-card">
                    <div class="coupon-header">
                        <div class="coupon-code"><%= coupon.code %></div>
                        <h6 class="coupon-name"><%= coupon.name %></h6>
                    </div>
                    <div class="coupon-body">
                        <div class="coupon-details">
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-percentage"></i>
                                    Discount:
                                </span>
                                <span class="detail-value">
                                    <span class="discount-amount"><%= coupon.discountAmount %>% OFF</span>
                                </span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-shopping-cart"></i>
                                    Min Purchase:
                                </span>
                                <span class="detail-value">₹<%= coupon.minPurchaseAmount %></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-calendar"></i>
                                    Valid Until:
                                </span>
                                <span class="detail-value"><%= coupon.expiresOn.toDateString() %></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-users"></i>
                                    Remaining Uses:
                                </span>
                                <span class="detail-value"><%= coupon.usedCount %> / <%= coupon.usageLimit %></span>
                            </div>
                        </div>
                        <button class="btn btn-copy" data-coupon="<%= coupon.code %>">
                            <i class="fas fa-copy mr-2"></i>
                            Copy Code & Apply
                        </button>
                    </div>
                </div>

               <% }) %>
                

               <% flatCoupons.forEach( coupon => { %>

               <div class="coupon-card">
                    <div class="coupon-header">
                        <div class="coupon-code"><%= coupon.code %></div>
                        <h6 class="coupon-name"><%= coupon.name %></h6>
                    </div>
                    <div class="coupon-body">
                        <div class="coupon-details">
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-percentage"></i>
                                    Discount:
                                </span>
                                <span class="detail-value">
                                    <span class="discount-amount">₹<%= coupon.discountAmount %> OFF</span>
                                </span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-shopping-cart"></i>
                                    Min Purchase:
                                </span>
                                <span class="detail-value">₹<%= coupon.minPurchaseAmount %></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-calendar"></i>
                                    Valid Until:
                                </span>
                                <span class="detail-value"><%= coupon.expiresOn.toDateString() %></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-users"></i>
                                    Remaining Uses:
                                </span>
                                <span class="detail-value"><%= coupon.usedCount %>/<%= coupon.usageLimit %></span>
                            </div>
                        </div>
                        <button class="btn btn-copy" data-coupon="<%= coupon.code %>">
                            <i class="fas fa-copy mr-2"></i>
                            Copy Code & Apply
                        </button>
                    </div>
                </div>

               <% }) %>

               <% expiredCoupons.forEach(coupon => { %>
        
                 <div class="coupon-card coupon-expired">
                    <div class="coupon-header">
                        <div class="coupon-code"><%= coupon.code %></div>
                        <h6 class="coupon-name"><%= coupon.name %></h6>
                    </div>
                    <div class="coupon-body">
                        <div class="coupon-details">
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-percentage"></i>
                                    Discount:
                                </span>
                                <span class="detail-value">
                                    <span class="discount-amount"><%= coupon.discountType === "percentage"? `${coupon.discountAmount} % OFF`:`₹${coupon.discountAmount}  OFF` %></span>
                                </span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-shopping-cart"></i>
                                    Min Purchase:
                                </span>
                                <span class="detail-value">₹<%= coupon.minPurchaseAmount %></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-calendar"></i>
                                    Valid Until:
                                </span>
                                <span class="detail-value"><%= coupon.expiresOn.toDateString() %></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">
                                    <i class="fas fa-users"></i>
                                    Remaining Uses:
                                </span>
                                <span class="detail-value"><%= coupon.usedCount %>/<%= coupon.usageLimit %></span>
                            </div>
                        </div>
                        <button class="btn btn-expired" disabled>
                            <i class="fas fa-clock mr-2"></i>
                            Expired
                        </button>
                    </div>
                </div>

               <% }) %>

        <% } else { %>

                   <div class="no-coupons">
                    <i class="fas fa-tags"></i>
                    <h5>No Coupons Available</h5>
                    <p class="text-muted">Check back later for exciting offers and discounts!</p>
                </div>

            <% } %>



    <!--====== Google Analytics: change UA-XXXXX-Y to be your site's ID ======-->
    <script>
        window.ga = function() {
            ga.q.push(arguments)
        };
        ga.q = [];
        ga.l = +new Date;
        ga('create', 'UA-XXXXX-Y', 'auto');
        ga('send', 'pageview')
    </script>
    <script src="https://www.google-analytics.com/analytics.js" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!--====== Vendor Js ======-->
    <script src="js/vendor.js"></script>

    <!--====== jQuery Shopnav plugin ======-->
    <script src="js/jquery.shopnav.js"></script>

    <!--====== App ======-->
    <script src="js/app.js"></script>

    <!--====== Razorpay ======-->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    

    <script>
  let currentDeliveryCharge = 0;
        
 function toggleCODBasedOnTotal() {
    let grandTotalText = $('#grand-total').text().replace(/[₹,]/g, '');
    let grandTotal = parseFloat(grandTotalText) || 0;

    if(grandTotal > 1000) {
        $('#cod').prop('disabled', true).prop('checked', false);
    } else {
        $('#cod').prop('disabled', false);
    }
 }

 function toggleWalletPayment() {
    const walletBalance = parseFloat($('#wallet-balance').data('balance')) || 0;
    const grandTotal = parseFloat($('#grand-total').text().replace(/[₹,]/g, '')) || 0;

    if (walletBalance < grandTotal) {
        $('#wallet-payment')
            .prop('disabled', true)
            .prop('checked', false)
            .closest('.radio-box')
            .addClass('disabled');

        $('.wallet-balance-inline').append('<span class="text-danger ml-2">(Insufficient balance)</span>');
    } else {
        $('#wallet-payment')
            .prop('disabled', false)
            .closest('.radio-box')
            .removeClass('disabled');
    }
}

 async function calculateDeliveryChargeForSelectedAddress() {
    const selectedAddress = document.querySelector(".address-radio:checked");
    if(!selectedAddress) return;

    const addressData = JSON.parse(selectedAddress.dataset.address);
    const userCity = addressData.city;

    try {
        const chargeResponse = await fetch('/calculate-delivery-charge', {
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ city: userCity })
        });

        const chargeData = await chargeResponse.json();

        if(chargeData.success) {
            const { deliveryCharge } = chargeData;

            console.log(deliveryCharge);
            

            currentDeliveryCharge = deliveryCharge;


            // Update checkout summary
            const grandTotalElem = $('#grand-total');
            const currentTotal = parseFloat(grandTotalElem.text().replace(/[₹,]/g, '')) || 0;

             // Remove previous shipping row and find its value
            const shippingRow = $('.o-summary__table tbody').find('tr:contains("SHIPPING")');
            let previousCharge = 0;

            if (shippingRow.length) {
                previousCharge = parseFloat(shippingRow.find('td:last').text().replace(/[₹,]/g, '')) || 0;
                shippingRow.remove();
            }

            // Find SUBTOTAL row
            const subtotalRow = $('.o-summary__table tbody').find('tr:contains("SUBTOTAL")');

            // Insert new SHIPPING row after SUBTOTAL
            $(`<tr><td>SHIPPING</td><td>₹${deliveryCharge.toFixed(2)}</td></tr>`).insertAfter(subtotalRow);

            // Update grand total
            const newTotal = currentTotal - previousCharge + deliveryCharge;
            grandTotalElem.text(`₹${newTotal.toFixed(2)}`);

           toggleCODBasedOnTotal();
        } else {
            Swal.fire('Error', 'Failed to fetch delivery charge.', 'error');
        }
    } catch (error) {
        console.error("Error calculating delivery charge:", error);
    }
 }

$(document).ready(function() {

    toggleCODBasedOnTotal();

    toggleWalletPayment();

    calculateDeliveryChargeForSelectedAddress();

   // Save Selected Address

      document.querySelector(".checkout-modal2__form").addEventListener("submit", async (event) => {
    event.preventDefault(); // Prevent form submission and page reload

    const selectedAddress = document.querySelector(".address-radio:checked").value;

    try {
        const response = await fetch("/saveSelectedAddress", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ selectedAddress }),
        });

        if (response.ok) {
            Swal.fire({
                icon: "success",
                title: "Address Saved!",
                text: "Your selected address has been updated.",
            }).then(() => {
                calculateDeliveryChargeForSelectedAddress();
                window.location.reload(); // Reload the page to see the updated address
            });
        } else {
            const result = await response.json();
            Swal.fire({
                icon: "error",
                title: "Error",
                text: result.message || "Failed to save the selected address. Please try again.",
            });
        }
    } catch (error) {
        console.error("Error saving selected address:", error);
        Swal.fire({
            icon: "error",
            title: "Error",
            text: "An unexpected error occurred. Please try again later.",
        });
    }
});

    
        
            // ----------------------
            //   Delete Cart Item
            // ----------------------

        window.deleteItem = async function(id) {
            try {

                // Use fetch API to send data
                const response = await fetch(`/deleteCartItem/${id}`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                },

                });

                const result = await response.json();  //parse the response (convert int normal from JSON)  ie it would like normal key value pair in an object

                if (response.ok) {
                    
                Swal.fire({
                    icon: "success",
                    title: "Item Delete!",
                    text: result.message || "The Item has been successfully deleted",
                }).then(() => {
                    window.location.href = "/checkout"
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: result.message || "Failed to delete the item. Please try again.",
                });
                }
            } catch (error) {
                Swal.fire({
                icon: "error",
                title: "Error",
                text: "An unexpected error occurred. Please try again later.",
                });
                }
            }


            // ----------------------
            //    Handle Order Form Submission (Razorpay / COD)
            // ----------------------

    
        $('#orderForm').submit(function (e) {
                e.preventDefault();

                const paymentMethod = $('input[name ="payment"]:checked').val();
                const formData = $(this).serialize();   // to make it urlencoded

                //  Check if shipping address exists
                if (!$('input[name="shippingAddress[name]"]').length) {
                    Swal.fire('Missing Address', 'Please select a shipping address before placing the order.', 'warning');
                    return;
                }

                //  Check if payment method is selected
                if (!paymentMethod) {
                    Swal.fire('Missing Payment', 'Please select a payment method to continue.', 'warning');
                    return;
                }
                        

                
    if (paymentMethod === 'Razorpay') {

        console.log("ifRazorpay", formData);
        

        $.ajax({
            method: 'POST',
            url: '/create-razorpay-order',
            data: formData,
            success: function (orderData) {
                if (orderData.success === false) {
                    //  If backend sent validation error
                    Swal.fire('Error', orderData.message || 'Invalid order data', 'error');
                    return;
                }
                const options = {
                    key: orderData.key_id,
                    amount: orderData.amount,
                    currency: "INR",
                    name: "The Elegant Adobe",
                    description: "Order Payment",
                    order_id: orderData.razorpay_order_id,

                    handler: function (response) {
                        // Step 2: Payment succeeded, verify with server
                        $.ajax({
                            method: 'POST',
                            url: '/verify-razorpay-payment',
                            data: {
                                ...response,
                                formData: formData
                            },
                            success: function (res) {
                                if (res.success) {
                                    Swal.fire('Success', 'Order Placed Successfully!', 'success')
                                        .then(() => window.location.href = '/order-success');
                                } else {
                                    Swal.fire('Error', 'Payment verification failed', 'error');
                                }
                            }
                        });
                    },

                   modal: {
                        ondismiss: function () {
                            // Optional: handle manual close
                            console.log("User dismissed Razorpay modal.");
                             window.location.href = '/payment-failed';
                        }
                    },

                    theme: {
                        color: "#F37254"
                    }
                };

                const rzp = new Razorpay(options);
                rzp.on('payment.failed', function (response) {
                    $.ajax({
                        method: 'POST',
                        url: '/razorpay-payment-failed',
                        data: formData,
                        success: function (res) {
                            if (res.success) {
                                window.location.href = '/payment-failed';
                            } else {
                                Swal.fire('Error', 'Failed to log failed payment.', 'error');
                            }
                        }
                    });
                });
                rzp.open();
            },
            error: function () {
                Swal.fire('Error', 'Failed to initialize payment', 'error');
            }
        });
    } else if(paymentMethod === 'wallet') {
        $.ajax({
            method: 'POST',
            url: '/wallet-order',
            data: formData,
            success: function (res) {
                if (res.success) {
                    Swal.fire('success', 'Payment completed with Wallet!', 'success')
                    .then(() => window.location.href = '/order-success');
                } else {
                    Swal.fire('Error', res.message || 'Wallet payment failed', 'error');
                }
            }, 
            error: function () {
                Swal.fire('Error', 'Server error during wallet payment.', 'error');
            }
        })
    } else {
        // Cash on Delivery or other methods
        $.ajax({
            method: 'POST',
            url: '/order-save',
            data: formData,
            success: function (res) {
                console.log("formData", formData);
                
                if (res.success) {
                    Swal.fire('Success', 'Order Placed Successfully!', 'success')
                        .then(() => window.location.href = '/order-success');
                } else {
                    Swal.fire('Error', res.message || 'Order placement failed', 'error');
                }
            },
            error: function () {
                Swal.fire('Error', 'Server error during order placement.', 'error');
            }
        });
    }

});

 async function fetchDeliveryCharge() {
    const selectedAddress = document.querySelector('.address-radio:checked');

    if (!selectedAddress) return 0;
    
    const addressData = JSON.parse(selectedAddress.dataset.address);
    const userPincode = addressData.pincode;
    console.log("Inside fetchDelivery", addressData, userPincode);

    const userCity = addressData.city;
    

    try {
        const response = await fetch('/calculate-delivery-charge', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ city: userCity })
        });

        const data = await response.json();
        console.log("data", data);
        
        if (data.success) {
            return data.deliveryCharge;
        } else {
            console.warn('Delivery charge fetch failed:', data.message);
            return 0;  
        }
    } catch (error) {
        console.error('Error fetching delivery charge:',error);
        return 0;
    }
 }

    
    // Handle copy button click
    $('.btn-copy').on('click', function() {
        var couponCode = $(this).data('coupon');
        
        
        
        // Copy to clipboard
        copyToClipboard(couponCode);
        
        $('#coupon').val(couponCode);
        
        // Show success message
        showSuccess();

        closeModalProperly();
       
    });

     // Proper modal close function
    function closeModalProperly() {
        $('#couponModal').modal('hide');
        
        // Force remove backdrop and blur after modal hide
        setTimeout(function() {
            $('.modal-backdrop').remove();
            $('body').removeClass('modal-open');
            $('body').css('padding-right', '');
        }, 300); // Wait for Bootstrap's animation to complete
    }
    
    // Also handle when modal is manually closed
    $('#couponModal').on('hidden.bs.modal', function() {
        // Ensure backdrop is completely removed
        $('.modal-backdrop').remove();
        $('body').removeClass('modal-open');
        $('body').css('padding-right', '');
    });
    
    // Copy to clipboard function
    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).catch(function() {
                console.log('❌ Failed to copy with modern method:', err);
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }
    
    // Fallback copy method for older browsers
    function fallbackCopy(text) {
        var textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
    }
    
    // Show success notification
    function showSuccess() {
    swal.fire({
        title: "Copied!",
        text: "Coupon code has been coppied",
        icon: "success",
        timer: 2000,           // Auto close after 2 seconds
        buttons: false,        // No buttons needed
        dangerMode: false,
        className: "sweet-alert-custom"  // Optional: for custom styling
    });
}
    



    // AJAX handler for coupon code application 

    // Handle coupon form submission - using the actual class from your HTML
    $('.c-f__form').on('submit', function(e) {
        e.preventDefault();
        
        const couponCode = $('#coupon').val().trim();
        
        if (!couponCode) {
            Swal.fire({
                icon: 'warning',
                title: 'Missing Coupon Code',
                text: 'Please enter a coupon code',
                confirmButtonColor: '#3085d6'
            });
            return;
        }

        // Show loading alert
        showLoadingAlert();
        
        // Show loading state
        const submitBtn = $(this).find('button[type="submit"]');
        const originalText = submitBtn.text();
        submitBtn.text('APPLYING...').prop('disabled', true);
        
        // AJAX request to apply coupon
        $.ajax({
            url: '/apply-coupon', 
            method: 'POST',
            data: {
                couponCode: couponCode,
                // Add any other required data like cart items, user ID, etc.
            },
            dataType: 'json',
            success: async function(response) {
                Swal.close(); 
                if (response.success) {
                    // Update the UI with new values
                    updateOrderSummary(response.data);

                    //  Use the custom full modal with savings
                    showCouponSuccess(response.message || 'Coupon applied successfully!', response.data.appliedDiscount);
                    
                    
                    // Update button states after successful coupon application
                    updateButtonsAfterCouponApply(response.data.appliedDiscount);
                    console.log("coupon-frontend-one");
                    
                    
                    // Disable the coupon input
                    $('#coupon').prop('disabled', true);
                    console.log("coupon-frontend-two");
                    
                } else {
                    // Show error message with SweetAlert
                    Swal.fire({
                        icon: 'error',
                        title: 'Invalid Coupon',
                        text: response.message || 'Invalid coupon code',
                        confirmButtonColor: '#d33'
                    });
                }
            },
            error: function(xhr, status, error) {
                Swal.close(); 
                console.error('AJAX Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Connection Error',
                    text: 'Something went wrong. Please try again.',
                    confirmButtonColor: '#d33'
                });
            },
            complete: function() {
                
                // Reset button state
                submitBtn.text(originalText).prop('disabled', false);
            }
        });
    });
    
    // Function to update order summary with new values
    async function updateOrderSummary(data) {
        const { grandTotal, subtotal, appliedDiscount, discountAmount } = data;
        const summaryTable = $('.o-summary__table tbody');

        // Fetch delivery charge based on selected address
        const deliveryCharge = await fetchDeliveryCharge();

       // Calculate final grand total after discount + shipping
       const finalTotal  = grandTotal + deliveryCharge;
        
        // Clear existing rows
        summaryTable.empty();
        
        // Add SUBTOTAL row 
        summaryTable.append(`
            <tr>
                <td>SUBTOTAL</td>
                <td>₹${subtotal.toFixed(2)}</td>
            </tr>
        `);
        
        // Add SHIPPING row 
        summaryTable.append(`
            <tr>
                <td>SHIPPING</td>
                <td>₹${deliveryCharge.toFixed(2)}</td>
            </tr>
        `);
        
        // Add discount row if discount is applied 
        if (appliedDiscount && discountAmount > 0) {
            summaryTable.append(`
                <tr class="discount-row">
                    <td>DISCOUNT (${appliedDiscount})</td>
                    <td class="discount-amount" style="padding-right:12px;">-₹${discountAmount.toFixed(2)}</td>
                </tr>
            `);
        }
        
        // Add GRAND TOTAL row 
        summaryTable.append(`
            <tr>
                <td>GRAND TOTAL</td>
                <td id="grand-total">₹${finalTotal.toFixed(2)}</td>
            </tr>
        `);
        
        // Add animation effect
        // summaryTable.fadeOut(200).fadeIn(400);

        toggleCODBasedOnTotal();
    }
    
    // Function to update buttons after coupon is applied
    function updateButtonsAfterCouponApply(appliedCouponCode) {
        const buttonContainer = $('.c-f__form .u-s-m-b-15').last(); // Get the button container
        
        // Disable and update the Apply button
        const applyBtn = buttonContainer.find('button[type="submit"]');
        applyBtn.text('APPLIED').prop('disabled', true).addClass('btn-applied');
        
        // Add the Remove button next to Apply button
        const removeBtn = `
            <button id="removeCouponBtn" type="button" class="btn btn--e-brand-b-2 remove-coupon-btn u-s-m-l-10" style="margin-left: 10px;">
                REMOVE
            </button>
        `;
        
        // Check if remove button doesn't already exist
        if (!buttonContainer.find('.remove-coupon-btn').length) {
            buttonContainer.append(removeBtn);
        }
        
        // Show which coupon is applied
        const couponInfo = `
            <div class="applied-coupon-info u-s-m-t-10">
                <small class="text-success">
                    <i class="fas fa-check-circle"></i> 
                    Coupon "${appliedCouponCode}" applied successfully
                </small>
            </div>
        `;
        
        // Add coupon info if it doesn't exist
        if (!$('.applied-coupon-info').length) {
            $('.c-f').append(couponInfo);
        }
    }
    
    
    function resetButtonsAfterCouponRemove() {
        const buttonContainer = $('.c-f__form .u-s-m-b-15').last();
        
        // Reset the Apply button
        const applyBtn = buttonContainer.find('button[type="submit"]');
        applyBtn.text('APPLY').prop('disabled', false).removeClass('btn-applied');
        
        // Remove the Remove button
        buttonContainer.find('.remove-coupon-btn').remove();
        
        // Remove coupon info
        $('.applied-coupon-info').remove();
        
        // Enable the coupon input
        $('#coupon').prop('disabled', false).val('');
    }
    
    // Function to show messages to user
    function showMessage(message, type) {
        // Remove existing messages
        $('.coupon-message').remove();
        
        const messageClass = type === 'success' ? 'alert-success' : 'alert-danger';
        const messageHtml = `
            <div class="alert ${messageClass} coupon-message" style="margin-top: 10px;">
                ${message}
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            </div>
        `;
        
        // Append to the form container - using your actual HTML structure
        $('.c-f').append(messageHtml);
        
        // Auto hide success messages after 3 seconds
        if (type === 'success') {
            setTimeout(() => {
                $('.coupon-message').fadeOut();
            }, 3000);
        }
    }
});

function showSuccessToast(message) {
    Swal.fire({
        icon: 'success',
        title: message,
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true
    });
}

// 2. Full modal with custom styling
function showCouponSuccess(message, savings) {
    Swal.fire({
        icon: 'success',
        title: 'Coupon Applied Successfully!',
        html: `
            <p>${message}</p>
            <p><strong>You saved: ₹${savings}</strong></p>
        `,
        confirmButtonText: 'Great!',
        confirmButtonColor: '#28a745',
        showClass: {
            popup: 'animate__animated animate__fadeInDown'
        },
        hideClass: {
            popup: 'animate__animated animate__fadeOutUp'
        }
    });
}

// 3. Loading state while processing
function showLoadingAlert() {
    Swal.fire({
        title: 'Applying Coupon...',
        text: 'Please wait while we process your coupon code.',
        allowOutsideClick: false,
        allowEscapeKey: false,
        showConfirmButton: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
}

 $(document).on('click', '#removeCouponBtn', function () {
    console.log("inside remove");
    
    $.ajax({
      url: '/remove-coupon',
      method: 'POST',
      success: function (response) {
        if (response.success) {
          
          $('.applied-coupon-info').remove(); // Remove coupon box
          $('.discount-row').remove();
          (async () => {
            const deliveryCharge = await fetchDeliveryCharge();
            const finalTotal = response.data.grandTotal + deliveryCharge;
            $('#grand-total').text(`₹${finalTotal.toFixed(2)}`);

            // Update shipping row too
            const summaryTable = $('.o-summary__table tbody');
            summaryTable.find('tr:contains("SHIPPING")').remove();
            summaryTable.prepend(`
                <tr><td>SHIPPING</td><td>₹${deliveryCharge.toFixed(2)}</td></tr>
            `);
          })();

          toggleCODBasedOnTotal();

          //  Restore the coupon form to its original state
                const buttonContainer = $('.c-f__form .u-s-m-b-15').last();

                // Reset Apply button
                const applyBtn = buttonContainer.find('button[type="submit"]');
                applyBtn.text('APPLY').prop('disabled', false).removeClass('btn-applied');

                // Remove the Remove button
                buttonContainer.find('.remove-coupon-btn').remove();

                // Enable and clear the coupon input
                $('#coupon').prop('disabled', false).val('');

          Swal.fire({
                    icon: 'success',
                    title: 'Coupon Removed',
                    text: response.message || 'Coupon removed successfully!',
                    timer: 2000,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });
        } else {
          Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: response.message || 'Something went wrong.',
                    confirmButtonColor: '#d33'
                });
        }
      },
      error: function () {
        Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to remove coupon. Try again later.',
                confirmButtonColor: '#d33'
            });
      }
    });
  });
</script>


    <!--====== Noscript ======-->
    <noscript>
        <div class="app-setting">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="app-setting__wrap">
                            <h1 class="app-setting__h1">JavaScript is disabled in your browser.</h1>

                            <span class="app-setting__text">Please enable JavaScript in your browser or upgrade to a JavaScript-capable browser.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </noscript>
</body>
</html>