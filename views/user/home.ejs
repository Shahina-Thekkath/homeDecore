<%-include("../../views/partials/user/header")%>
        <!--====== End - Header Wrapper ======-->

        
        <!--====== App Content ======-->
        <div class="app-content">

            <!--====== Primary Slider ======-->
            <div class="s-skeleton s-skeleton--h-640 s-skeleton--bg-grey">
                <div class="owl-carousel primary-style-3" id="hero-slider">
                    <div class="hero-slide hero-slide--7">
                        <div class="primary-style-3-wrap">
                            <div class="container">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="slider-content slider-content--animation">

                                            <span class="content-span-1 u-c-white">Create Your Dream Home</span>

                                            <span class="content-span-2 u-c-white">Best Lighting Designs</span>

                                            <span class="content-span-3 u-c-white">Elegance in every piece</span>

                                            <span class="content-span-4 u-c-white">Starting At

                                                <span class="u-c-brand">₹2000.00</span></span>

                                            <a class="shop-now-link btn--e-brand" href="/productList">SHOP NOW</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-slide hero-slide--8">
                        <div class="primary-style-3-wrap">
                            <div class="container">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="slider-content slider-content--animation">

                                            <span class="content-span-1 u-c-white">Open Your Eyes</span>

                                            <span class="content-span-2 u-c-white">Exclusive Deals on Lighting & Decor</span>

                                            <span class="content-span-3 u-c-white">Modern Designs for Every Corner</span>

                                            <span class="content-span-4 u-c-white">Starting At

                                                <span class="u-c-brand">₹999.00</span></span>

                                            <a class="shop-now-link btn--e-brand" href=/productList">SHOP NOW</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-slide hero-slide--9">
                        <div class="primary-style-3-wrap">
                            <div class="container">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="slider-content slider-content--animation">

                                            <span class="content-span-1 u-c-white">Transform Your Living Space</span>

                                            <span class="content-span-2 u-c-white">Up to 15% Off on Lighting & Accessories</span>

                                            <span class="content-span-3 u-c-white">Discover Elegant Home Decor Pieces</span>

                                            <span class="content-span-4 u-c-white">Starting At

                                                <span class="u-c-brand">₹1000.00</span></span>

                                            <a class="shop-now-link btn--e-brand" href="/productList">SHOP NOW</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--====== End - Primary Slider ======-->


            <!--====== Section 1 ======-->
            <div class="u-s-p-y-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-4 col-md-4 col-sm-6 u-s-m-b-30">
                                <div class="promotion-o">
                                    <div class="aspect aspect--bg-grey aspect--square">

                                        <img class="aspect__img" src="images/promo/Konoha-homepage-banner.webp" alt=""></div>
                                    <!-- <div class="promotion-o__content">

                                        <a class="promotion-o__link btn--e-white-brand" href="shop-side-version-2.html">Women's Clothing</a></div> -->
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 u-s-m-b-30">
                                <div class="promotion-o">
                                    <div class="aspect aspect--bg-grey aspect--square">

                                        <img class="aspect__img" src="images/promo/Ikebana_harubana_desk.webp" alt=""></div>
                                    <!-- <div class="promotion-o__content">

                                        <a class="promotion-o__link btn--e-white-brand" href="shop-side-version-2.html">Fashion Accessories</a></div> -->
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-6 u-s-m-b-30">
                                <div class="promotion-o">
                                    <div class="aspect aspect--bg-grey aspect--square">

                                        <img class="aspect__img" src="images/promo/Ikebana_midori.webp" alt=""></div>
                                    <!-- <div class="promotion-o__content">

                                        <a class="promotion-o__link btn--e-white-brand" href="shop-side-version-2.html">Men's Clothing</a></div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 1 ======-->


            <!--====== Section 2 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-6 col-md-12">

                                    <a class="i3-banner" href="/productList">
                                        <div class="aspect aspect--bg-grey-fb aspect--square">

                                            <img class="aspect__img i3-banner__img" src="images/banners/home-page-bottom-banners-furniture1.webp" alt=""></div>
                                    </a></div>
                                <div class="col-lg-6 col-md-12">
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-6 u-s-m-b-30">
                                            <div class="product-short u-h-100">
                                                <div class="product-short__container">
                                                    <div class="product-short__img-wrap">

                                                        <a class="aspect aspect--bg-grey-fb aspect--square u-d-block" href="#">  
                                                            <!-- productDetail -->

                                                            <img class="aspect__img product-short__img" src="images/product2/wallPainting1.png" alt=""></a></div>
                                                    <div class="product-short__info">

                                                        <span class="product-short__price">₹9,190.00</span>

                                                        <span class="product-short__name">

                                                            <a href="#">Canvas Wall Painting</a></span>

                                                        <span class="product-short__category">

                                                            <a href="/productList">Home Decore</a></span></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6 col-sm-6 u-s-m-b-30">
                                            <div class="product-short u-h-100">
                                                <div class="product-short__container">
                                                    <div class="product-short__img-wrap">

                                                        <a class="aspect aspect--bg-grey-fb aspect--square u-d-block" href="#">

                                                            <img class="aspect__img product-short__img" src="images/product2/desert.png" alt=""></a></div>
                                                    <div class="product-short__info">

                                                        <span class="product-short__price">₹6,250.00</span>

                                                        <span class="product-short__name">

                                                            <a href="#">Canvas Wall Painting</a></span>
                                                            <!-- productDetails -->

                                                        <span class="product-short__category">

                                                            <a href="/productList">Home Decore</a></span></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">

                                            <a class="i3-banner" href="#">
                                                <div class="aspect aspect--bg-grey-fb aspect--1048-334">

                                                    <img class="aspect__img i3-banner__img" src="images/banners/AL.webp" alt=""></div>
                                            </a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 2 ======-->


            <!--====== Section 3 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Intro ======-->
                <div class="section__intro u-s-m-b-46">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="section__text-wrap">
                                    <h1 class="section__heading u-c-secondary u-s-m-b-12">RECENT PRODUCTS</h1>

                                    <span class="section__span u-c-silver">NEWLY ADDED PRODUCTS</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Intro ======-->


                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <%for(let i = products.length-1;i>=0;i--){%>
                            <div class="col-lg-3 col-md-4 col-sm-6 u-s-m-b-30">
                                <div class="product-r u-h-100">
                                    <div class="product-r__container">

                                        <a class="aspect aspect--bg-grey aspect--square u-d-block" href="/product-details/<%=products[i]._id%>">
                                            <% let img = products[i].image[0] %>
                                            <% if(typeof img === "object"){ %>
                                                <img class="aspect__img" src="<%= img.url %>" alt="" >
                                            <% } %>
                                            </a>
                                        <div class="product-r__action-wrap">
                                            <ul class="product-r__action-list">
                                               
                                                <li>

                                                    <a class="add-to-cart-btn" 
                                                       data-id="<%= products[i]._id %>" 
                                                       data-name="<%= products[i].name %>" 
                                                       data-image="<%= products[i].image[0].url %>" 
                                                       data-price="<%= products[i].price %>">
                                                       <i class="fas fa-plus-circle"></i></a></li>
                                                <li>

                                                    <a href="#" class="add-to-wishlist" data-id="<%= products[i]._id %>"><i class="fas fa-heart"></i></a></li>
                                               
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="product-r__info-wrap">

                                        <span class="product-r__category">

                                            <a href="shop-side-version-2.html"><%=products[i].name%></a></span>
                                        <div class="product-r__n-p-wrap">

                                            <span class="product-r__name">

                                               

                                            <% if(products[i].discountInfo){ %>
                                                <span class="product-r__price">₹<%=products[i].finalPrice%>

                                                    <span class="product-o__discount">₹<%=products[i].originalPrice%></span> </span>
                                                 <% if(products[i].discountInfo.type === 'percentage'){ %>
                                                        <span class="offer-badge"><%=products[i].discountInfo.amount%>% OFF</span>
                                                    <% } %>
                                                
                                               

                                                   
                                            <% } else { %>
                                                <span class="product-r__price">₹<%=products[i].originalPrice%></span>
                                            <% } %>
                                            
                                        
                                        </div>

                                        
                                    </div>
                                </div>
                            </div>

                            <%}%>

                             <div class="col-lg-12">
                                <div class="load-more">

                                    <button class="btn btn--e-brand" type="button" onclick="window.location.href='/productList'">Load More</button></div>
                            </div>
                           
                          
                            
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 3 ======-->

           
        </div>
        <!--====== End - App Content ======-->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>
        const socket = io();

        socket.on("connect", () => {
            console.log("USER SOCKET CONNECTED:", socket.id);

            <%if (locals.user && locals.user._id) {%>
              socket.emit("joinRoom", { role: "user", userId: "<%= user._id %>" })              
            <%}%>

        });

        socket.on("product:stockChanged", (data) => {
            console.log("USER RECEIVED product:stockChanged", data);
            location.reload();
        });

        socket.on("product:updated", (data) => {
        console.log("USER RECEIVED product:updated", data);
        location.reload();
       });

       socket.on("product:added", () => {
            location.reload();
        });

        socket.on("product:statusChanged", () => {
            location.reload();
        });

        socket.on("category:statusChanged", () => {
            location.reload();
        });

        socket.on("offer:changed", (data) => {
            console.log("Offer updated:", data);
            location.reload();
        });

        <% if (locals.user && locals.user._id) { %>
        socket.on("user:blocked", (data) => {
            alert(data.message);
            window.location.href = "/login"; // force logout
        });

        socket.on("user:unblocked", (data) => {
            alert(data.message);
            location.reload(); // refresh page so actions work
        });
    <% } %>

        
</script>
<script>


    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const successMessage = urlParams.get('logout');
        if (successMessage) {
            Swal.fire({
                position: "center",
                icon: "success",
                title: successMessage,
                showConfirmButton: false,
                timer: 1500
            }).then(() => {
                window.location.href = "/"; // Redirect to remove query parameters
            });
        }
    });
</script>
<script>
      $(document).ready(function () {
        $(".add-to-wishlist").on('click', function(e) {
            e.preventDefault();

            const productId = $(this).data("id");

            $.ajax({
                url: "/add-to-wishlist",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ productId }),
                success: function (response) {
                    if(response.success) {
                        Swal.fire({
                            icon: "success",
                            title: response.message,
                            timer: 1500,
                            showConfirmButton: false
                        });
                    } else if (response.error){
                       Swal.fire({
                        icon: "info",
                        title: response.error,
                        timer: 1500,
                        showConfirmButton: false
                       });
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: "error",
                        title: "Failed to add to wishlist",
                        text: "Please login",
                    })
                }
            })
        })

        $(".add-to-cart-btn").on("click", function (e) {
            e.preventDefault();

            const productId = $(this).data("id");
            const name = $(this).data("name");
            const price = $(this).data("price");
            const image = $(this).data("image");
            

            $.ajax({
                url: "/add-to-cart",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ productId, quantity: 1 }),
                success: function (response) {
                    if(response.success) {
                        
                        $("#modal-product-image").attr("src", image);
                        $("#add-to-cart .success__name").text(name);
                        $("#add-to-cart .success__price").text("₹" + price);
                        $("#add-to-cart .success__quantity").text("Quantity:1");

                        

                        $("#add-to-cart").modal("show");
                        } else if (response.error === "Please login first") {
                            Swal.fire({
                            icon: "warning",
                            title: "You need to login",
                            showConfirmButton: true
                            }).then(() => {
                            window.location.href = "/login";
                            });
                        } else {
                        Swal.fire({
                            icon: "info",
                            title: response.error || "Already in cart",
                            timer: 1500,
                            showConfirmButton: false
                        });
                    }
                },
                error: function (xhr, status, error) {
                     
                    $("#add-to-cart").modal("hide");
                    let errMsg = "Could not add to cart";
                    if (xhr.responseJSON && xhr.responseJSON.error) {
                        errMsg = xhr.responseJSON.error; // from backend: res.status(400).json({ error: "..." })
                    } else if (xhr.responseJSON && xhr.responseJSON.message) {
                        errMsg = xhr.responseJSON.message; // in case backend sends { message: "..." }
                    }

                     


                    Swal.fire("Error", errMsg, "error");
                }
            })
        })
      })

</script>
<%-include("../../views/partials/user/footer")%>
       